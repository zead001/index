<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة السعرات والجدول الغذائي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            direction: rtl;
            text-align: right;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            text-align: center;
            color: #004d40;
        }

        .input-section, .results-section, .manual-plan-section, .add-food-section, .sample-plans-section {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #e8f5e9;
        }

        .results-section {
            background-color: #f1f8e9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #00796b;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        button.delete-button {
            background-color: #d32f2f;
        }
        
        button.delete-button:hover {
            background-color: #b71c1c;
        }

        button:hover {
            background-color: #004d40;
        }
        
        button.add-plan-btn {
            background-color: #4CAF50;
            margin-bottom: 10px;
        }
        
        button.add-plan-btn:hover {
            background-color: #388E3C;
        }

        .meal-plan-builder {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .meal-builder-item {
            background-color: #f1f8e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
        }

        .add-food-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .add-food-controls select, .add-food-controls input {
            flex-grow: 1;
            min-width: 150px;
        }
        
        .food-list ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        
        .food-list li {
            background-color: #e8f5e9;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .food-list li .remove-btn {
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
        }

        /* New styles for progress bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
        }
        .progress-bar {
            height: 20px;
            background-color: #4caf50;
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: white;
            transition: width 0.5s ease-in-out;
            min-width: 0;
        }
        .search-container {
            margin-bottom: 10px;
        }
        .search-container input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .sample-plan-card {
            background-color: #fff;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .macro-summary {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .sample-plan-card ul {
            list-style: none;
            padding: 0;
        }
        
        .sample-plan-card li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }
        
        .add-item-btn {
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 18px;
            cursor: pointer;
            line-height: 1;
            padding-bottom: 3px;
            transition: background-color 0.3s;
        }
        
        .add-item-btn:hover {
            background-color: #004d40;
        }
        
        .food-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .food-item-info input[type="number"] {
            width: 70px;
            padding: 5px;
            text-align: center;
        }
    </style>
</head>
<body onload="loadData()">
    <div class="container">
        <h1>حاسبة السعرات والجدول الغذائي</h1>

        <div class="input-section">
            <h2>البيانات الشخصية والهدف</h2>
            <div class="form-group">
                <label for="age">العمر (سنوات):</label>
                <input type="number" id="age" min="1" required>
            </div>
            <div class="form-group">
                <label for="gender">الجنس:</label>
                <select id="gender">
                    <option value="male">ذكر</option>
                    <option value="female">أنثى</option>
                </select>
            </div>
            <div class="form-group">
                <label for="weight">الوزن (كجم):</label>
                <input type="number" id="weight" min="1" required>
            </div>
            <div class="form-group">
                <label for="height">الطول (سم):</label>
                <input type="number" id="height" min="1" required>
            </div>
            <div class="form-group">
                <label for="activity">مستوى النشاط:</label>
                <select id="activity">
                    <option value="1.2">قليل جداً (عمل مكتبي)</option>
                    <option value="1.375">خفيف (تمرين خفيف 1-3 أيام/أسبوع)</option>
                    <option value="1.55">معتدل (تمرين 3-5 أيام/أسبوع)</option>
                    <option value="1.725">عالي (تمرين يومي)</option>
                    <option value="1.9">عالي جداً (تمرين مكثف يومي)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="goal">الهدف:</label>
                <select id="goal">
                    <option value="lose">خسارة وزن</option>
                    <option value="maintain">ثبات وزن</option>
                    <option value="gain">زيادة وزن</option>
                </select>
            </div>
            <button onclick="calculateCalories()">احسب السعرات</button>
            <button class="delete-button" onclick="clearData()">حذف البيانات المحفوظة</button>
        </div>

        <div id="results" class="results-section" style="display:none;">
            <h2>نتائجك اليومية</h2>
            <p>احتياجك اليومي من السعرات: <strong id="tdee-result"></strong> سعرة حرارية</p>
            <p>سعراتك المستهدفة: <strong id="target-calories"></strong> سعرة حرارية</p>
            
            <div class="macro-summary">
                <p>البروتين المستهدف: <strong id="target-protein"></strong> غرام</p>
                <p>الكربوهيدرات المستهدفة: <strong id="target-carbs"></strong> غرام</p>
                <p>الدهون المستهدفة: <strong id="target-fat"></strong> غرام</p>
            </div>
            <hr>
            <h3>المغذيات المستهلكة</h3>
            <p>سعراتك المستهلكة: <strong id="consumed-calories">0</strong> سعرة حرارية</p>
            <p>سعراتك المتبقية: <strong id="remaining-calories">0</strong> سعرة حرارية</p>
            <div class="progress-bar-container">
                <div id="calorie-progress" class="progress-bar" style="width: 0%;"></div>
            </div>
            <p>بروتينك المستهلك: <strong id="consumed-protein">0</strong> غرام</p>
            <div class="progress-bar-container">
                <div id="protein-progress" class="progress-bar" style="width: 0%;"></div>
            </div>
            <p>كربوهيدراتك المستهلكة: <strong id="consumed-carbs">0</strong> غرام</p>
            <div class="progress-bar-container">
                <div id="carbs-progress" class="progress-bar" style="width: 0%;"></div>
            </div>
            <p>دهونك المستهلكة: <strong id="consumed-fat">0</strong> غرام</p>
            <div class="progress-bar-container">
                <div id="fat-progress" class="progress-bar" style="width: 0%;"></div>
            </div>
            <hr>
            <h3>مؤشر كتلة الجسم (BMI): <strong id="bmi-result"></strong></h3>
            <p id="weight-recommendation"></p>
        </div>

        <div id="sample-plans-section" class="sample-plans-section" style="display:none;">
            <h2>خطط غذائية جاهزة</h2>
            <div id="sample-plans-container"></div>
        </div>

        <div id="manual-plan-section" class="manual-plan-section" style="display:none;">
            <h2>اختر وجباتك بنفسك</h2>
            <div class="add-food-controls">
                <select id="meal-select">
                    <option value="breakfast">الفطور</option>
                    <option value="lunch">الغداء</option>
                    <option value="dinner">العشاء</option>
                    <option value="snack">وجبة خفيفة</option>
                </select>
                <div class="search-container">
                    <input type="text" id="food-search" placeholder="ابحث عن طعام..." oninput="filterFoodList()">
                </div>
                <select id="food-select" class="food-select"></select>
                <input type="number" id="food-quantity" class="food-quantity" min="1" value="100" placeholder="الكمية (غرام)">
                <button onclick="addFood()">أضف</button>
            </div>
            <div class="meal-plan-builder">
                <div class="meal-builder-item">
                    <h3>الفطور</h3>
                    <div class="food-list">
                        <ul id="breakfast-list"></ul>
                    </div>
                </div>
                <div class="meal-builder-item">
                    <h3>الغداء</h3>
                    <div class="food-list">
                        <ul id="lunch-list"></ul>
                    </div>
                </div>
                <div class="meal-builder-item">
                    <h3>العشاء</h3>
                    <div class="food-list">
                        <ul id="dinner-list"></ul>
                    </div>
                </div>
                <div class="meal-builder-item">
                    <h3>وجبات خفيفة</h3>
                    <div class="food-list">
                        <ul id="snack-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="add-food-section" class="add-food-section" style="display:none;">
            <h2>إضافة صنف غذائي جديد</h2>
            <div class="form-group">
                <label for="new-food-name">اسم الصنف:</label>
                <input type="text" id="new-food-name" placeholder="مثال: دجاج مقلي">
            </div>
            <div class="form-group">
                <label for="new-food-category">التصنيف:</label>
                <select id="new-food-category">
                    <option value="grains">حبوب وخبز</option>
                    <option value="vegetables">خضار</option>
                    <option value="fruits">فواكه</option>
                    <option value="poultry">دواجن</option>
                    <option value="meat">لحوم</option>
                    <option value="fish">أسماك</option>
                    <option value="legumes">بقوليات</option>
                    <option value="nuts">مكسرات</option>
                    <option value="dairy">ألبان</option>
                    <option value="fats">دهون</option>
                    <option value="sweets">حلويات</option>
                    <option value="other">أخرى</option>
                </select>
            </div>
            <div class="form-group">
                <label for="new-food-calories">سعرات حرارية (لكل 100g):</label>
                <input type="number" id="new-food-calories" min="0">
            </div>
            <div class="form-group">
                <label for="new-food-protein">بروتين (غرام):</label>
                <input type="number" id="new-food-protein" min="0">
            </div>
            <div class="form-group">
                <label for="new-food-carbs">كربوهيدرات (غرام):</label>
                <input type="number" id="new-food-carbs" min="0">
            </div>
            <div class="form-group">
                <label for="new-food-fat">دهون (غرام):</label>
                <input type="number" id="new-food-fat" min="0">
            </div>
            <button onclick="addNewFoodItem()">أضف الصنف</button>
        </div>
    </div>
    <script>
        const foodDatabase = {
            'بروكلي': { calories: 34, protein: 2.8, carbs: 7, fat: 0.4, category: 'vegetables' },
            'سبانخ': { calories: 23, protein: 2.9, carbs: 3.6, fat: 0.4, category: 'vegetables' },
            'كوسا': { calories: 17, protein: 1.2, carbs: 3.1, fat: 0.3, category: 'vegetables' },
            'جزر': { calories: 41, protein: 0.9, carbs: 10, fat: 0.2, category: 'vegetables' },
            'بندورة': { calories: 18, protein: 0.9, carbs: 3.9, fat: 0.2, category: 'vegetables' },
            'خيار': { calories: 15, protein: 0.7, carbs: 3.6, fat: 0.1, category: 'vegetables' },
            'خس': { calories: 15, protein: 1.4, carbs: 2.9, fat: 0.2, category: 'vegetables' },
            'بقدونس': { calories: 36, protein: 3, carbs: 6.3, fat: 0.8, category: 'vegetables' },
            'كزبرة': { calories: 23, protein: 2.1, carbs: 3.7, fat: 0.5, category: 'vegetables' },
            'كرنب (ملفوف)': { calories: 25, protein: 1.3, carbs: 5.8, fat: 0.1, category: 'vegetables' },
            'فليفلة ملونة': { calories: 31, protein: 1, carbs: 6, fat: 0.3, category: 'vegetables' },
            'بصل': { calories: 40, protein: 1.1, carbs: 9.3, fat: 0.1, category: 'vegetables' },
            'ثوم': { calories: 149, protein: 6.4, carbs: 33, fat: 0.5, category: 'vegetables' },
            'باذنجان': { calories: 25, protein: 1, carbs: 6, fat: 0.2, category: 'vegetables' },
            'فطر (عيش الغراب)': { calories: 22, protein: 3.1, carbs: 3.3, fat: 0.3, category: 'vegetables' },
            'كرنب بروكسل': { calories: 43, protein: 3.4, carbs: 9, fat: 0.3, category: 'vegetables' },
            'كرفس': { calories: 16, protein: 0.7, carbs: 3, fat: 0.2, category: 'vegetables' },
            'شمندر': { calories: 43, protein: 1.6, carbs: 9.6, fat: 0.2, category: 'vegetables' },
            'جرجير': { calories: 25, protein: 2.6, carbs: 3.7, fat: 0.7, category: 'vegetables' },
            'بطاطا حلوة': { calories: 86, protein: 1.6, carbs: 20, fat: 0.1, category: 'vegetables' },
            'تفاح': { calories: 52, protein: 0.3, carbs: 14, fat: 0.2, category: 'fruits' },
            'برتقال': { calories: 47, protein: 0.9, carbs: 12, fat: 0.1, category: 'fruits' },
            'موز': { calories: 89, protein: 1.1, carbs: 23, fat: 0.3, category: 'fruits' },
            'رمان': { calories: 83, protein: 1.7, carbs: 19, fat: 1.2, category: 'fruits' },
            'كيوي': { calories: 61, protein: 1.1, carbs: 15, fat: 0.5, category: 'fruits' },
            'أناناس': { calories: 50, protein: 0.5, carbs: 13, fat: 0.1, category: 'fruits' },
            'عنب': { calories: 69, protein: 0.7, carbs: 18, fat: 0.2, category: 'fruits' },
            'توت أزرق': { calories: 57, protein: 0.7, carbs: 14, fat: 0.3, category: 'fruits' },
            'فراولة': { calories: 32, protein: 0.7, carbs: 7.7, fat: 0.3, category: 'fruits' },
            'توت بري': { calories: 46, protein: 0.4, carbs: 12, fat: 0.1, category: 'fruits' },
            'خوخ': { calories: 39, protein: 0.9, carbs: 9.5, fat: 0.3, category: 'fruits' },
            'مشمش': { calories: 48, protein: 1.4, carbs: 11, fat: 0.4, category: 'fruits' },
            'كمثرى': { calories: 57, protein: 0.4, carbs: 15, fat: 0.1, category: 'fruits' },
            'بطيخ': { calories: 30, protein: 0.6, carbs: 7.6, fat: 0.2, category: 'fruits' },
            'شمام': { calories: 34, protein: 0.8, carbs: 8.2, fat: 0.2, category: 'fruits' },
            'مانجا': { calories: 60, protein: 0.8, carbs: 15, fat: 0.4, category: 'fruits' },
            'تين': { calories: 74, protein: 0.7, carbs: 19, fat: 0.3, category: 'fruits' },
            'جوافة': { calories: 68, protein: 2.6, carbs: 14, fat: 1, category: 'fruits' },
            'كرز': { calories: 50, protein: 1, carbs: 12, fat: 0.3, category: 'fruits' },
            'صدر دجاج مشوي': { calories: 165, protein: 31, carbs: 0, fat: 3.6, category: 'poultry' },
            'ديك رومي': { calories: 135, protein: 30, carbs: 0, fat: 1, category: 'poultry' },
            'لحم بقر قليل الدهن': { calories: 250, protein: 26, carbs: 0, fat: 15, category: 'meat' },
            'سمك سلمون': { calories: 208, protein: 20, carbs: 0, fat: 13, category: 'fish' },
            'تونة (معلبة بالماء)': { calories: 132, protein: 28, carbs: 0, fat: 1, category: 'fish' },
            'سردين': { calories: 208, protein: 25, carbs: 0, fat: 11, category: 'fish' },
            'بياض البيض': { calories: 52, protein: 11, carbs: 0.7, fat: 0.2, category: 'poultry' },
            'جبنة قليلة الدسم': { calories: 100, protein: 15, carbs: 4, fat: 3, category: 'dairy' },
            'عدس': { calories: 116, protein: 9, carbs: 20, fat: 0.4, category: 'legumes' },
            'حمص': { calories: 164, protein: 9, carbs: 27, fat: 3, category: 'legumes' },
            'فول': { calories: 88, protein: 8, carbs: 15, fat: 0.5, category: 'legumes' },
            'فاصولياء (حمراء/سوداء)': { calories: 127, protein: 8.7, carbs: 22.8, fat: 0.5, category: 'legumes' },
            'بازلاء': { calories: 81, protein: 5.4, carbs: 14.5, fat: 0.4, category: 'legumes' },
            'التوفو': { calories: 76, protein: 8, carbs: 1.9, fat: 4.8, category: 'legumes' },
            'إدامامي': { calories: 122, protein: 11, carbs: 9.9, fat: 5.2, category: 'legumes' },
            'شوفان (ناشف)': { calories: 389, protein: 17, carbs: 66, fat: 7, category: 'grains' },
            'برغل': { calories: 83, protein: 3.1, carbs: 18.6, fat: 0.2, category: 'grains' },
            'كينوا': { calories: 120, protein: 4.1, carbs: 21, fat: 1.9, category: 'grains' },
            'أرز بني': { calories: 111, protein: 2.6, carbs: 23, fat: 0.9, category: 'grains' },
            'أرز بسمتي': { calories: 121, protein: 2.5, carbs: 26, fat: 0.3, category: 'grains' },
            'خبز قمح كامل': { calories: 250, protein: 13, carbs: 49, fat: 3.8, category: 'grains' },
            'شعير': { calories: 123, protein: 3.4, carbs: 28.2, fat: 0.4, category: 'grains' },
            'ذرة': { calories: 86, protein: 3.3, carbs: 19, fat: 1.1, category: 'grains' },
            'بطاطا عادية مسلوقة': { calories: 87, protein: 1.9, carbs: 20, fat: 0.1, category: 'vegetables' },
            'مكرونة قمح كامل': { calories: 124, protein: 5.2, carbs: 25, fat: 0.6, category: 'grains' },
            'لوز': { calories: 579, protein: 21, carbs: 22, fat: 50, category: 'nuts' },
            'جوز': { calories: 654, protein: 15, carbs: 14, fat: 65, category: 'nuts' },
            'كاجو': { calories: 553, protein: 18, carbs: 30, fat: 44, category: 'nuts' },
            'فستق حلبي': { calories: 562, protein: 20, carbs: 28, fat: 45, category: 'nuts' },
            'بندق': { calories: 628, protein: 15, carbs: 17, fat: 61, category: 'nuts' },
            'بذور الشيا': { calories: 486, protein: 16, carbs: 42, fat: 31, category: 'seeds' },
            'بذور الكتان': { calories: 534, protein: 18, carbs: 29, fat: 42, category: 'seeds' },
            'بذور القرع': { calories: 559, protein: 30, carbs: 10, fat: 49, category: 'seeds' },
            'بذور دوار الشمس': { calories: 584, protein: 21, carbs: 20, fat: 51, category: 'seeds' },
            'سمسم': { calories: 573, protein: 18, carbs: 23, fat: 50, category: 'seeds' },
            'لبن يوناني (خالي الدسم)': { calories: 59, protein: 10, carbs: 3.6, fat: 0.4, category: 'dairy' },
            'لبن قليل الدسم': { calories: 61, protein: 3.5, carbs: 4.7, fat: 3.3, category: 'dairy' },
            'جبنة قريش (Cottage)': { calories: 98, protein: 11, carbs: 3.4, fat: 4.3, category: 'dairy' },
            'جبنة بيضاء قليلة الملح': { calories: 80, protein: 10, carbs: 1, fat: 4, category: 'dairy' },
            'حليب قليل الدسم': { calories: 42, protein: 3.4, carbs: 5, fat: 1, category: 'dairy' },
            'زيت الزيتون': { calories: 884, protein: 0, carbs: 0, fat: 100, category: 'fats' },
            'زيت جوز الهند': { calories: 862, protein: 0, carbs: 0, fat: 100, category: 'fats' },
            'زيت الأفوكادو': { calories: 884, protein: 0, carbs: 0, fat: 100, category: 'fats' },
            'أفوكادو': { calories: 160, protein: 2, carbs: 9, fat: 15, category: 'fruits' },
            'زبدة فول سوداني طبيعية': { calories: 588, protein: 25, carbs: 20, fat: 50, category: 'fats' },
            'زبدة لوز': { calories: 614, protein: 21, carbs: 20, fat: 54, category: 'fats' },
            'ماء': { calories: 0, protein: 0, carbs: 0, fat: 0, category: 'drinks' },
            'شاي أخضر (بدون سكر)': { calories: 0, protein: 0, carbs: 0, fat: 0, category: 'drinks' },
            'شاي أعشاب': { calories: 1, protein: 0, carbs: 0.2, fat: 0, category: 'drinks' },
            'قهوة سوداء': { calories: 2, protein: 0.3, carbs: 0, fat: 0, category: 'drinks' },
            'عصير برتقال طبيعي': { calories: 45, protein: 0.7, carbs: 10, fat: 0.2, category: 'drinks' },
            'خبز عربي': { calories: 275, protein: 9, carbs: 56, fat: 1.2, category: 'grains' },
            'كرواسون': { calories: 406, protein: 8, carbs: 45, fat: 21, category: 'pastries' },
            'مكرونة مسلوقة': { calories: 131, protein: 5, carbs: 25, fat: 1.1, category: 'grains' },
            'توست أبيض': { calories: 265, protein: 9, carbs: 49, fat: 3.2, category: 'grains' },
            'لحم غنم مشوي': { calories: 294, protein: 25, carbs: 0, fat: 21, category: 'meat' },
            'جمبري مسلوق': { calories: 99, protein: 24, carbs: 0.2, fat: 0.3, category: 'seafood' },
            'سمك تروتة': { calories: 148, protein: 20, carbs: 0, fat: 7, category: 'fish' },
            'بيض': { calories: 78, protein: 6.3, carbs: 0.6, fat: 5.3, category: 'dairy' },
            'فول الصويا مطبوخ': { calories: 172, protein: 16, carbs: 9.9, fat: 9, category: 'legumes' },
            'زبادي كامل الدسم': { calories: 61, protein: 3.5, carbs: 4.7, fat: 3.3, category: 'dairy' },
            'لبنة': { calories: 110, protein: 10, carbs: 3, fat: 6, category: 'dairy' },
            'جبنة صفراء': { calories: 402, protein: 25, carbs: 1.3, fat: 33, category: 'dairy' },
            'جبنة فيتا': { calories: 264, protein: 14, carbs: 4, fat: 21, category: 'dairy' },
            'جبنة موتزاريلا': { calories: 280, protein: 28, carbs: 3, fat: 17, category: 'dairy' },
            'زيت نباتي': { calories: 884, protein: 0, carbs: 0, fat: 100, category: 'fats' },
            'زبدة': { calories: 717, protein: 0.9, carbs: 0.1, fat: 81, category: 'fats' },
            'مايونيز': { calories: 680, protein: 1, carbs: 0.6, fat: 75, category: 'fats' },
            'شوكولاتة بالحليب': { calories: 546, protein: 7.5, carbs: 61, fat: 31, category: 'sweets' },
            'بسكويت عادي': { calories: 502, protein: 6.5, carbs: 67, fat: 23, category: 'sweets' },
            'كيك ساده': { calories: 406, protein: 6, carbs: 50, fat: 20, category: 'sweets' },
            'عسل طبيعي': { calories: 304, protein: 0.3, carbs: 82, fat: 0, category: 'sweets' },
            'مشروب كاكاو ساخن': { calories: 54, protein: 1, carbs: 12, fat: 0.8, category: 'drinks' },
            'فاصوليا خضراء': { calories: 31, protein: 1.8, carbs: 7, fat: 0.2, category: 'vegetables' },
            'بامية': { calories: 33, protein: 2, carbs: 7.5, fat: 0.2, category: 'vegetables' },
            'كسكس': { calories: 112, protein: 3.8, carbs: 23.2, fat: 0.2, category: 'grains' },
            'فريكة': { calories: 153, protein: 5.7, carbs: 32, fat: 1.2, category: 'grains' },
            'خبز شعير': { calories: 250, protein: 10, carbs: 52, fat: 2, category: 'grains' },
            'جبنة حلوم': { calories: 321, protein: 22, carbs: 2.2, fat: 25, category: 'dairy' },
            'خبز تورتيلا أسمر': { calories: 298, protein: 9, carbs: 54, fat: 4, category: 'grains' },
            'قرفة': { calories: 247, protein: 4, carbs: 81, fat: 1.2, category: 'spices' },
        };
        
        const samplePlans = [
            {
                name: "خطة 1700 سعرة",
                calories: 1700,
                meals: {
                    breakfast: [
                        { name: "شوفان (ناشف)", quantity: 50 },
                        { name: "حليب قليل الدسم", quantity: 200 },
                        { name: "موز", quantity: 50 },
                        { name: "لوز", quantity: 15 }
                    ],
                    lunch: [
                        { name: "صدر دجاج مشوي", quantity: 150 },
                        { name: "أرز بني", quantity: 150 },
                        { name: "سلطة خضار", quantity: 200 }
                    ],
                    dinner: [
                        { name: "عدس", quantity: 100 },
                        { name: "خبز قمح كامل", quantity: 50 },
                        { name: "سلطة خضار", quantity: 150 }
                    ],
                    snack: [
                        { name: "تفاح", quantity: 100 },
                        { name: "زبادي كامل الدسم", quantity: 100 }
                    ]
                }
            },
            {
                name: "خطة 2000 سعرة",
                calories: 2000,
                meals: {
                    breakfast: [
                        { name: "بيض", quantity: 100 },
                        { name: "خبز قمح كامل", quantity: 75 },
                        { name: "زيت الزيتون", quantity: 5 },
                        { name: "سبانخ", quantity: 50 }
                    ],
                    lunch: [
                        { name: "لحم بقر قليل الدهن", quantity: 120 },
                        { name: "برغل", quantity: 150 },
                        { name: "سلطة خضار", quantity: 200 }
                    ],
                    dinner: [
                        { name: "سمك سلمون", quantity: 150 },
                        { name: "بطاطا عادية مسلوقة", quantity: 100 },
                        { name: "بروكلي", quantity: 150 }
                    ],
                    snack: [
                        { name: "موز", quantity: 100 },
                        { name: "لوز", quantity: 20 }
                    ]
                }
            },
            {
                name: "خطة 2500 سعرة",
                calories: 2500,
                meals: {
                    breakfast: [
                        { name: "لبنة", quantity: 50 },
                        { name: "زيت الزيتون", quantity: 10 },
                        { name: "خبز شعير", quantity: 100 },
                        { name: "خيار", quantity: 50 },
                        { name: "بندورة", quantity: 50 }
                    ],
                    lunch: [
                        { name: "صدر دجاج مشوي", quantity: 200 },
                        { name: "أرز بسمتي", quantity: 200 },
                        { name: "فاصوليا خضراء", quantity: 100 }
                    ],
                    dinner: [
                        { name: "فول", quantity: 150 },
                        { name: "خبز قمح كامل", quantity: 75 },
                        { name: "زيت الزيتون", quantity: 5 },
                        { name: "سلطة خضار", quantity: 100 }
                    ],
                    snack: [
                        { name: "زبادي كامل الدسم", quantity: 100 },
                        { name: "جوز", quantity: 20 },
                        { name: "تمر", quantity: 50 }
                    ]
                }
            }
        ];

        let targetCalories = 0;
        let consumedCalories = 0;
        let targetProtein = 0;
        let consumedProtein = 0;
        let targetCarbs = 0;
        let consumedCarbs = 0;
        let targetFat = 0;
        let consumedFat = 0;
        
        function saveData() {
            const userData = {
                age: document.getElementById('age').value,
                gender: document.getElementById('gender').value,
                weight: document.getElementById('weight').value,
                height: document.getElementById('height').value,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value
            };
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function loadData() {
            const savedUserData = localStorage.getItem('userData');
            if (savedUserData) {
                const userData = JSON.parse(savedUserData);
                document.getElementById('age').value = userData.age;
                document.getElementById('gender').value = userData.gender;
                document.getElementById('weight').value = userData.weight;
                document.getElementById('height').value = userData.height;
                document.getElementById('activity').value = userData.activity;
                document.getElementById('goal').value = userData.goal;
            }
            
            if (savedUserData) {
                 calculateCalories();
                 document.getElementById('add-food-section').style.display = 'block';
                 document.getElementById('manual-plan-section').style.display = 'block';
                 document.getElementById('sample-plans-section').style.display = 'block';
            }
        }
        
        function clearData() {
            localStorage.clear();
            alert('تم حذف جميع البيانات المحفوظة.');
            window.location.reload();
        }

        function calculateCalories() {
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;
            const activityFactor = document.getElementById('activity').value;
            const goal = document.getElementById('goal').value;

            if (!age || !weight || !height) {
                alert('يرجى إدخال جميع البيانات الشخصية.');
                return;
            }

            let bmr;
            if (gender === 'male') {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }

            const tdee = bmr * activityFactor;
            targetCalories = tdee;

            if (goal === 'lose') {
                targetCalories = tdee - 500;
            } else if (goal === 'gain') {
                targetCalories = tdee + 500;
            }

            // Calculate macronutrient targets based on a 30-40-30 split
            targetProtein = (targetCalories * 0.30) / 4;
            targetCarbs = (targetCalories * 0.40) / 4;
            targetFat = (targetCalories * 0.30) / 9;

            document.getElementById('tdee-result').textContent = Math.round(tdee);
            document.getElementById('target-calories').textContent = Math.round(targetCalories);
            document.getElementById('target-protein').textContent = Math.round(targetProtein);
            document.getElementById('target-carbs').textContent = Math.round(targetCarbs);
            document.getElementById('target-fat').textContent = Math.round(targetFat);
            
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            
            let bmiStatus = '';
            let weightRecommendation = '';
            
            const minHealthyWeight = 18.5 * (heightInMeters * heightInMeters);
            const maxHealthyWeight = 24.9 * (heightInMeters * heightInMeters);
            
            if (bmi < 18.5) {
                bmiStatus = 'نحيف';
                weightRecommendation = `وزنك الحالي أقل من المعدل الطبيعي. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            } else if (bmi >= 18.5 && bmi < 24.9) {
                bmiStatus = 'وزن صحي';
                weightRecommendation = `وزنك الحالي ضمن المعدل الطبيعي. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            } else if (bmi >= 25 && bmi < 29.9) {
                bmiStatus = 'زيادة في الوزن';
                weightRecommendation = `وزنك الحالي أكثر من المعدل الطبيعي. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            } else if (bmi >= 30 && bmi < 34.9) {
                bmiStatus = 'سمنة من الدرجة الأولى';
                weightRecommendation = `وزنك الحالي ضمن فئة السمنة. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            } else if (bmi >= 35 && bmi < 39.9) {
                bmiStatus = 'سمنة من الدرجة الثانية';
                weightRecommendation = `وزنك الحالي ضمن فئة السمنة. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            } else {
                bmiStatus = 'سمنة مفرطة';
                weightRecommendation = `وزنك الحالي ضمن فئة السمنة المفرطة. الوزن الصحي المناسب لك هو بين ${Math.round(minHealthyWeight)} و ${Math.round(maxHealthyWeight)} كجم.`;
            }
            
            document.getElementById('bmi-result').textContent = `${bmi.toFixed(2)} - ${bmiStatus}`;
            document.getElementById('weight-recommendation').textContent = weightRecommendation;

            consumedCalories = 0;
            consumedProtein = 0;
            consumedCarbs = 0;
            consumedFat = 0;
            updateSummary();

            document.getElementById('results').style.display = 'block';
            document.getElementById('add-food-section').style.display = 'block';
            document.getElementById('manual-plan-section').style.display = 'block';
            document.getElementById('sample-plans-section').style.display = 'block';

            filterFoodList();
            displaySamplePlans();
            saveData();
        }

        function displaySamplePlans() {
            const plansContainer = document.getElementById('sample-plans-container');
            plansContainer.innerHTML = '';

            if (targetCalories === 0) return;

            samplePlans.forEach(plan => {
                const planCard = document.createElement('div');
                planCard.className = 'sample-plan-card';

                let planHTML = `<h3>${plan.name} (${plan.calories} سعرة)</h3>`;
                planHTML += `<button class="add-plan-btn" onclick="addFullPlan(${JSON.stringify(plan.meals).replace(/'/g, "\\'")})">اختيار هذه الخطة</button>`;

                for (const meal in plan.meals) {
                    planHTML += `<h4>${getMealLabel(meal)}</h4>`;
                    planHTML += `<ul>`;
                    plan.meals[meal].forEach(item => {
                        const foodData = foodDatabase[item.name] || {};
                        const itemCalories = Math.round((foodData.calories / 100) * item.quantity);
                        planHTML += `<li>
                            <span>${item.name} (${item.quantity} غرام) - ${itemCalories} سعرة</span>
                            <button class="add-item-btn" onclick="addSingleItemToManualPlan('${meal}', '${item.name}', ${item.quantity})">+</button>
                        </li>`;
                    });
                    planHTML += `</ul>`;
                }

                planCard.innerHTML = planHTML;
                plansContainer.appendChild(planCard);
            });
        }
        
        function addSingleItemToManualPlan(meal, foodName, quantity) {
            addFoodToManualList(meal, foodName, quantity);
            alert(`تمت إضافة ${foodName} إلى جدولك.`);
        }

        function addFullPlan(plan) {
            // Clear existing lists
            document.getElementById('breakfast-list').innerHTML = '';
            document.getElementById('lunch-list').innerHTML = '';
            document.getElementById('dinner-list').innerHTML = '';
            document.getElementById('snack-list').innerHTML = '';
            
            consumedCalories = 0;
            consumedProtein = 0;
            consumedCarbs = 0;
            consumedFat = 0;

            for (const meal in plan) {
                plan[meal].forEach(item => {
                    addFoodToManualList(meal, item.name, item.quantity);
                });
            }
            alert('تم إضافة الخطة بالكامل إلى جدولك اليومي.');
        }

        function getMealLabel(meal) {
            switch(meal) {
                case 'breakfast': return 'الفطور';
                case 'lunch': return 'الغداء';
                case 'dinner': return 'العشاء';
                case 'snack': return 'وجبات خفيفة';
            }
        }
        
        function addFood(meal = null, foodName = null, quantity = null) {
            
            if (!meal) {
                meal = document.getElementById('meal-select').value;
                foodName = document.getElementById('food-select').value;
                quantity = document.getElementById('food-quantity').value;
            }

            if (!foodName || !quantity || quantity <= 0) {
                alert('يرجى اختيار الطعام وإدخال كمية صحيحة.');
                return;
            }
            addFoodToManualList(meal, foodName, quantity);
        }

        function addFoodToManualList(meal, foodName, quantity) {
             const foodData = foodDatabase[foodName];
             if (!foodData) {
                console.error(`Food item '${foodName}' not found in database.`);
                return;
             }

             // حساب القيم الغذائية للصنف الذي سيتم إضافته
             const newCalories = (foodData.calories / 100) * quantity;
             const newProtein = (foodData.protein / 100) * quantity;
             const newCarbs = (foodData.carbs / 100) * quantity;
             const newFat = (foodData.fat / 100) * quantity;

             // التحقق من تجاوز الحدود
             if (targetCalories !== 0) {
                 if ((consumedCalories + newCalories) > targetCalories || 
                     (consumedProtein + newProtein) > targetProtein ||
                     (consumedCarbs + newCarbs) > targetCarbs) {
                     alert('لا يمكن إضافة هذا الصنف. سيؤدي ذلك إلى تجاوز الحدود المسموح بها من السعرات الحرارية أو البروتين أو الكربوهيدرات.');
                     return;
                 }
             }

             const listItem = document.createElement('li');
             listItem.dataset.foodName = foodName;
             listItem.dataset.initialQuantity = quantity;
             listItem.dataset.initialCalories = newCalories;
             listItem.dataset.initialProtein = newProtein;
             listItem.dataset.initialCarbs = newCarbs;
             listItem.dataset.initialFat = newFat;

             listItem.innerHTML = `
                <div class="food-item-info">
                    <span class="food-name">${foodName}</span>
                    <input type="number" value="${quantity}" min="1" oninput="updateFoodQuantity(this)">
                    <span>غرام</span>
                    <span class="food-macros"> - ${Math.round(newCalories)} سعرة | بروتين: ${Math.round(newProtein)}غ | كارب: ${Math.round(newCarbs)}غ | دهون: ${Math.round(newFat)}غ</span>
                </div>
                <button class="remove-btn" onclick="removeFood(this)">×</button>
            `;
            document.getElementById(`${meal}-list`).appendChild(listItem);
            
            consumedCalories += newCalories;
            consumedProtein += newProtein;
            consumedCarbs += newCarbs;
            consumedFat += newFat;
            updateSummary();
        }

        function updateFoodQuantity(inputElement) {
            const listItem = inputElement.closest('li');
            const foodName = listItem.dataset.foodName;
            const oldQuantity = parseFloat(listItem.dataset.initialQuantity);
            const newQuantity = parseFloat(inputElement.value);

            if (isNaN(newQuantity) || newQuantity <= 0) {
                inputElement.value = oldQuantity;
                return;
            }

            const foodData = foodDatabase[foodName];
            if (!foodData) return;

            const oldCalories = (foodData.calories / 100) * oldQuantity;
            const oldProtein = (foodData.protein / 100) * oldQuantity;
            const oldCarbs = (foodData.carbs / 100) * oldQuantity;
            const oldFat = (foodData.fat / 100) * oldQuantity;

            const newCalories = (foodData.calories / 100) * newQuantity;
            const newProtein = (foodData.protein / 100) * newQuantity;
            const newCarbs = (foodData.carbs / 100) * newQuantity;
            const newFat = (foodData.fat / 100) * newQuantity;

            // التحقق من تجاوز الحدود قبل التحديث
             if (targetCalories !== 0) {
                 const potentialCalories = consumedCalories - oldCalories + newCalories;
                 const potentialProtein = consumedProtein - oldProtein + newProtein;
                 const potentialCarbs = consumedCarbs - oldCarbs + newCarbs;
                 if (potentialCalories > targetCalories || 
                     potentialProtein > targetProtein ||
                     potentialCarbs > targetCarbs) {
                     alert('لا يمكن تعديل الكمية. سيؤدي ذلك إلى تجاوز الحدود المسموح بها من السعرات الحرارية أو البروتين أو الكربوهيدرات.');
                     inputElement.value = oldQuantity; // إعادة القيمة القديمة
                     return;
                 }
             }

            consumedCalories += (newCalories - oldCalories);
            consumedProtein += (newProtein - oldProtein);
            consumedCarbs += (newCarbs - oldCarbs);
            consumedFat += (newFat - oldFat);

            listItem.dataset.initialQuantity = newQuantity;
            listItem.dataset.initialCalories = newCalories;
            listItem.dataset.initialProtein = newProtein;
            listItem.dataset.initialCarbs = newCarbs;
            listItem.dataset.initialFat = newFat;

            const macrosSpan = listItem.querySelector('.food-macros');
            macrosSpan.textContent = ` - ${Math.round(newCalories)} سعرة | بروتين: ${Math.round(newProtein)}غ | كارب: ${Math.round(newCarbs)}غ | دهون: ${Math.round(newFat)}غ`;

            updateSummary();
        }
        
        function addNewFoodItem() {
            const foodName = document.getElementById('new-food-name').value;
            const foodCategory = document.getElementById('new-food-category').value;
            const calories = parseFloat(document.getElementById('new-food-calories').value);
            const protein = parseFloat(document.getElementById('new-food-protein').value);
            const carbs = parseFloat(document.getElementById('new-food-carbs').value);
            const fat = parseFloat(document.getElementById('new-food-fat').value);

            if (!foodName || isNaN(calories) || isNaN(protein) || isNaN(carbs) || isNaN(fat) || calories < 0 || protein < 0 || carbs < 0 || fat < 0) {
                alert('يرجى إدخال بيانات صحيحة وكاملة للصنف الجديد.');
                return;
            }
            
            foodDatabase[foodName] = {
                calories: calories,
                protein: protein,
                carbs: carbs,
                fat: fat,
                category: foodCategory
            };

            alert(`تمت إضافة صنف "${foodName}" بنجاح!`);
            
            document.getElementById('new-food-name').value = '';
            document.getElementById('new-food-calories').value = '';
            document.getElementById('new-food-protein').value = '';
            document.getElementById('new-food-carbs').value = '';
            document.getElementById('new-food-fat').value = '';

            filterFoodList();
        }

        function filterFoodList() {
            const searchTerm = document.getElementById('food-search').value.toLowerCase();
            const selectElement = document.getElementById('food-select');
            
            const categories = {};
            for (const foodName in foodDatabase) {
                if (foodName.toLowerCase().includes(searchTerm)) {
                    const food = foodDatabase[foodName];
                    const category = food.category;
                    if (!categories[category]) {
                        categories[category] = [];
                    }
                    categories[category].push(foodName);
                }
            }

            selectElement.innerHTML = '';
            const sortedCategories = Object.keys(categories).sort();
            sortedCategories.forEach(category => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = getCategoryLabel(category);
                
                categories[category].forEach(foodName => {
                    const option = document.createElement('option');
                    option.value = foodName;
                    option.textContent = foodName;
                    optgroup.appendChild(option);
                });
                
                selectElement.appendChild(optgroup);
            });
        }
        
        function getCategoryLabel(category) {
            const labels = {
                'grains': 'حبوب وخبز',
                'vegetables': 'خضار',
                'fruits': 'فواكه',
                'poultry': 'دواجن',
                'meat': 'لحوم',
                'fish': 'أسماك',
                'seafood': 'مأكولات بحرية',
                'legumes': 'بقوليات',
                'nuts': 'مكسرات',
                'seeds': 'بذور',
                'dairy': 'ألبان ومنتجاتها',
                'fats': 'زيوت ودهون',
                'sweets': 'حلويات',
                'drinks': 'مشروبات',
                'pastries': 'معجنات',
                'other': 'أخرى',
                'spices': 'بهارات'
            };
            return labels[category] || category;
        }

        function removeFood(button) {
            const listItem = button.closest('li');
            const calories = parseFloat(listItem.dataset.initialCalories);
            const protein = parseFloat(listItem.dataset.initialProtein);
            const carbs = parseFloat(listItem.dataset.initialCarbs);
            const fat = parseFloat(listItem.dataset.initialFat);
            
            listItem.remove();
            
            consumedCalories -= calories;
            consumedProtein -= protein;
            consumedCarbs -= carbs;
            consumedFat -= fat;
            updateSummary();
        }

        function updateSummary() {
            const remainingCalories = targetCalories - consumedCalories;
            const remainingProtein = targetProtein - consumedProtein;
            const remainingCarbs = targetCarbs - consumedCarbs;
            const remainingFat = targetFat - consumedFat;

            document.getElementById('consumed-calories').textContent = Math.round(consumedCalories);
            document.getElementById('remaining-calories').textContent = Math.round(remainingCalories);
            document.getElementById('consumed-protein').textContent = Math.round(consumedProtein);
            document.getElementById('consumed-carbs').textContent = Math.round(consumedCarbs);
            document.getElementById('consumed-fat').textContent = Math.round(consumedFat);

            const calorieProgressPercentage = (consumedCalories / targetCalories) * 100;
            const proteinProgressPercentage = (consumedProtein / targetProtein) * 100;
            const carbsProgressPercentage = (consumedCarbs / targetCarbs) * 100;
            const fatProgressPercentage = (consumedFat / targetFat) * 100;

            const updateProgressBar = (elementId, percentage) => {
                const bar = document.getElementById(elementId);
                bar.style.width = Math.min(percentage, 100) + '%';
                if (percentage > 100) {
                    bar.style.backgroundColor = '#d32f2f'; // Red
                } else {
                    bar.style.backgroundColor = '#4caf50'; // Green
                }
            };
            
            updateProgressBar('calorie-progress', calorieProgressPercentage);
            updateProgressBar('protein-progress', proteinProgressPercentage);
            updateProgressBar('carbs-progress', carbsProgressPercentage);
            updateProgressBar('fat-progress', fatProgressPercentage);
        }
    </script>
</body>
</html>